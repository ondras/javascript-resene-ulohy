# Kapitola 13: Když JavaScript nestačí

V poslední kapitole už nebudeme řešit konkrétní úlohu, ale ukážeme si další směry, kam se v rámci prozkoumávání klientských webových technologií můžeme vydávat. Jakkoliv je totiž JavaScript užitečný, samotný nám nedokáže poskytnout vše, co bychom mohli potřebovat. Podívejme se tedy na několik populárních knihoven a nadstaveb, se kterými se praxi můžeme setkat.


## Zelenáči: React

Pro mnohé frontendové vývojáře je knihovna React stejně důležitá, jako JavaScript samotný. Jedná se o nástroj původně vyvinutý pro interní potřeby projektu Facebook, který se následně rychle rozšířil po celém internetu. React je určen k tvorbě stromu stránky ze vstupních dat. Takovou úlohu jsme v této knize řešili několikrát -- použili jsme k tomu buď vestavěný HTML parser (tj. vlastnost `innerHTML`), nebo individuální metody rozhraní DOM (jako např. `document.createElement`). React volí přístup koncepčně někde mezi těmito dvěma variantami: strom stránky vytváříme deklarativně (jako kdybychom rovnou psali HTML), ale atributy a textové uzly můžeme generovat rovnou z JavaScriptových dat (jako kdybychom nastavovali atributy DOM objektům).

Důležitým aspektem knihovny React je tzv. *virtual DOM*. Při použití Reactu necháváme knihovnu vygenerovat výstup při libovolné změně ve vstupních datech, což zní jako zbytečná práce. React ale vzniklé HTML prvky negeneruje rovnou ve stránce, ale v rámci svého virtuálního dokumentu. Do stránky pak promítne jen ty úpravy, které znamenají změnu v opravdovém dokumentu.

React staví zejména na těchto konceptech:

- HTML výstup definujeme pomocí **značkovacího jazyka JSX**, který HTML připomíná. Jedná se o mix HTML a JavaScriptu; podobá se také trochu *template literals* (tyto řetězce jsme viděli v páté kapitole). React lze, striktně vzato, používat i bez JSX, ale připravujeme se tím o značné množství funkcionality.
- Jednotlivé části kódu organizujeme do tzv. **komponent**, které zodpovídají za jednotlivé části stromu dokumentu. V jazyce JSX komponenty vypadají jjako HTML značky a nápadně připomínají *Custom Elements* (devátá kapitola). Komponenty jsou typicky implementovány jako JavaScriptové funkce.
- Úkolem komponent (a Reactu jako takového) je prezentace dat. Tato jsou komponentám v jazyce JSX předávána pomocí atributů, které mohou -- v porovnání s HTML -- obsahovat libovolné datové typy.

React si můžeme vyzkoušet například na úloze z šesté kapitoly, ve které implementujeme zobrazování výsledků hledání.


## Koumáci: TypeScript

Pojďme si nyní prohlédnout další jazyk, který je dnes s JavaScriptem neodmyslitelně spojen. TypeScript vznikl jako nadmnožina JavaScriptu, ve které můžeme k proměnným a funkcím volitelně přidávat informace o jejich datovém typu. Říká se jim *typové anotace* a můžeme je znát i z dalších jazyků, jako např. Python či PHP. V JavaScriptu však typové anotace neexistují, takže kód psaný v TypeScriptu nemůžeme rovnou předhodit prohlížeči. Podobně jako u JSX je nutné nejprve kód převést na JavaScript. Tentokrát je ale převod velmi snadný, protože zahrnuje pouze smazání typových anotací.

A proč to celé vlastně chceme dělat? TypeScript je odpovědí na dynamické typování JavaScriptu, které je pro mnoho vývojářů až příliš flexibilní. Kvůli němu nelze rychlým pohledem na proměnnou či funkci odhadnout, jakých hodnot může nabývat. Snadno se pak vystavujeme riziku, že budeme nějakou hodnotu mylně považovat za jiný datový typ a dopustíme se různých chyb (např. výjimek způsobujících přerušení běhu programu).

S typovými anotacemi se v TypeScriptu setkáváme dvakrát. Když převádíme kód z TypeScriptu do JavaScriptu, kompilátor anotace nejen odstraní, ale také s jejich pomocí zkontroluje, zdali neporušujeme jimi definovaná pravidla -- jesti třeba do proměnné označené jako *string* nevkládáme číslo. Zároveň ale anotace používáme již při samotném psaní kódu, pokud si správně nastavíme editor. Ten může na základě typových informací rovnou označovat bloky problematického kódu, případně napovídat typy a názvy parametrů funkcí a podobně.

Zdrojový kód v TypeScriptu píšeme do souborů s příponou `.ts`. Nejčastěji se typové anotace objevují za dvojtečkou, za názvem proměnné či parametru funkce. Můžeme si to vyzkoušet na příkladu triviální sčítací funkce:

```ts
function add(a: number, b: number): number {
	return a+b;
}
```

Typové anotace jsme přidali jak k oběma parametrům, tak k funkci jako takové -- říkáme tím, že její návratová hodnota je číslo. Na chování kódu anotace nemají žádný vliv, takže pokud bychom funkci předali dva řetězce, dojde k jejich (pravděpodobně chybnému) spojení. Proto bychom rádi, aby nás nějaká komponenta zavčasu (na základě anotací) upozornila, že funkci voláme špatně. Nejprve napíšeme problémový kód:

```ts
let a = "protřepat";
let b = "nemíchat";
let c = add(a, b);
```

Dobře nastavené vývojové prostředí by nás už nyní mělo varovat, že funkci voláme chybně. My ale stojíme o kontrolu spojenou s převodem do prostého JavaScriptu. K tomu použijeme oficiální kompilátor *tsc* (TypeScript Compiler). Nainstalujeme jej pomocí npm:

```sh
npm i -g typescript
```

Pro spuštění kompilace stačí předat jméno souboru s TypeScriptovým kódem:

```sh
tsc test.ts  # FIXME jmeno souboru

test.ts:6:13 - error TS2345: Argument of type 'string' is not assignable to parameter of type 'number'.
```

Dostali jsme vynadáno přesně dle očekávání. Zároveň s tím ale vznikl soubor `test.js` FIXME, který obsahuje náš chybný kód bez anotací. Kompilátor nám tedy nebrání v psaní pochybného kódu, ale pokud mu k tomu dáme příležitost, upozorní nás na problematická místa.




## Profíci: WebAssembly

