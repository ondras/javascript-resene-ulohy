# Kapitola 8: Třídy a objekty

## Úloha

Administrační systém z minulé kapitoly se rozrostl a stávající implementace nedovoluje snadné rozšiřování. Rozdělte kód do menších, samostatně funkčích celků. Použijte techniky objektově orientovaného programování.

### Řešení

```html
<!-- kapitola-8.html -->
<h2>Nové komentáře</h2>
<ul id="new"></ul>

<h2>Schválené komentáře</h2>
<ul id="approved"></ul>

<script type="module" src="kapitola-8.js"></script>
```

```js
// kapitola-8.js
import Comment from "./comment.js";

export async function loadComments() {
	let response = await fetch("/comments");
	let data = await response.json();

	let newList = document.querySelector("#new");
	let approvedList = document.querySelector("#approved");
	newList.replaceChildren();
	approvedList.replaceChildren();

	comments.forEach(c => new Comment(c, newList, approvedList));
}

loadComments();
```

```js
// comment.js
import { loadComments } from "./kapitola-8.js";

export default class Comment {
	constructor(data, newList, approvedList) {
		this.id = data.id;

		let node = document.createElement("li");
		node.textContent = `${data.author}: ${data.text}`;

		if (!comment.approved) { node.append(this.buildApproveButton()); }
		node.append(this.buildDeleteButton());

		(data.approved ? approvedList : newList).append(node);
	}

	buildApproveButton() {
		let button = buildButton("Schválit");
		button.addEventListener("click", async e => {
			await this.approve();
			loadComments();
		});
		return button;
	}

	buildDeleteButton() {
		let button = buildButton("Smazat");
		button.addEventListener("click", async e => {
			await this.delete();
			loadComments();
		});
		return button;
	}

	delete() {
		return fetch(`/comments/${this.id}`, {method: "DELETE"});
	}

	approve(id) {
		return fetch(`/comments/${this.id}/approve`, {method: "POST"});
	}
}

function buildButton(label) {
	let button = document.createElement("button");
	button.textContent = label;
	return button;
}
```

### Co jsme se naučili

## Zelenáči: handleEvent a AbortController

## Koumáci: klíčové slovo `this`

## Profíci: prototypová dědičnost
