# Kapitola 2: První setkání

## Zadání

Pro fanoušky Karla Gotta chystáme vzpomínkový web, který bude obsahovat i texty písní. Některé jsou ale příliš dlouhé, takže je nutné zobrazit jen prvních několik znaků a zbytek textu skrýt. Po kliknutí na tlačítko se ukáže celý text písně.

## Řešení

```html
<h1>Mám styl Čendy</h1>
<pre>
Mezi námi je mnoho chvil
A pokusů, abych se ti zavděčil
Jenomže od tebe se člověk moc nedoví
Stále básníš o ňákém svém záhadném Čendovi
</pre>

<script>
let song = document.querySelector("pre");
let text = song.textContent;

song.textContent = text.substring(0, 50) + "...";

let button = document.createElement("button");
button.textContent = "zobrazit celý text";
song.append(button);

function showCompleteText() {
	song.textContent = text;
}
button.addEventListener("click", showCompleteText);
</script>
```

První setkání s JavaScriptem! Výše uvedený kód představuje řešení naší úlohy, které z textu písně zobrazí prvních 50 znaků a zbytek skryje. Po kliknutí na tlačítko se odhalí text celý.

Úvodem přiznejme, že se rozhodně nejedná o nejlepší řešení. Zkušený programátor v něm jistě nalezne místa k vylepšení. Některá z nich si ukážeme v první začátečnické podkapitole. Předtím se ale podíváme na celé vzorové řešení řádek po řádku a vysvětlíme, co vše se z něj můžeme naučit.

## Krok po kroku

Převážná většina této knihy se týká *klientského JavaScriptu*, tedy tomu scénáři, kdy jazyk používáme pro vylepšení webových stránek. Technologicky to znamená, že:
  - k vyzkoušení potřebujeme libovolný webový prohlížeč (tzv. *klient*)
  - v prohlížeči otevíráme webovou (HTML) stránku, jejíž přímou či nepřímou součástí je JavaScriptový kód
  - prohlížeč proto v rámci zobrazení stránky musí také stáhnout a vykonat instrukce, obsažené v tomto kódu

Z toho plyne, že není nutné používat žádný specializovaný software, který by JavaScript zpracovával (interpretoval, kompiloval, …). Naopak je potřeba alespoň trochu rozumět HTML, protože výsledná stránka je s JavaScriptem niterně provázána: kód píšeme proto, aby stránku vylepšoval, ovlivňoval a měnil.

Prvních několik řádků řešení je tím pádem prosté HTML (s ukázkou jednoho textu písně, za který děkujeme textaři panu Michalu Bukovičovi). Prohlížeč je zpracuje a zobrazí &ndash; kdyby ve zbylé části stránky nebyl žádný JavaScript, uživatel by viděl celý text. Přítomnost značky `<script>` ovšem prohlížeči káže, že než bude stránka hotová, je nezbytné vykonat uvedený kód.

Tím se dostáváme ke skriptu samotnému. Jeho první dva řádky začínají klíčovým slovem `let`, kterým uvozujeme definici proměnných. Vytváříme dvě proměnné (`song` a `text`) a rovnou je naplníme hodnotami pomocí znaku rovnítka (tzv. *operátor přiřazení*). Protože naším cílem je manipulace se stránkou (skrytí části textu), potřebujeme se především dostat k jednotlivýcm HTML prvkům ve stránce a jejich obsahu. To je ve světě klientského JavaScriptu možné pomocí sady funkcí a objektů, souhrnně nazývaných DOM &ndash; Document Object Model. Jedná se o velice silný nástroj, který budeme využívat v téměř všech kapitolách. Pomocí DOM můžeme do stránky vkládat nový obsah, upravovat existující, nebo klidně stránku celou vymazat a sestavit znova a jinak.

Rozhraní DOM je pro nás přístupné především pomocí globální vestavěné proměnné `document`. Ta odpovídá té stránce, kterou prohlížeč právě zobrazuje (a jejíž JavaScript je právě vykonáván). V dokumentaci lze nalézt veliké množství vlastností a funkcí, které takový `document` nabízí &ndash; na některé z nich se podíváme v nadcházející podkapitole pro FIXME. I zelenáč ovšem musí ovládat funkci `querySelector`, kterou používáme k tomu, abychom v dokumentu vyhledali konkrétní HTML prvek. Parametrem pro `querySelector` je řetězec obsahující *CSS selektor*, který známe ze světa CSS. Tam jej používáme pro stejný účel, když vybíráme HTML značky, na které se mají aplikovat daná stylová pravidla.

V první proměnné (`song`) tak skončí první značka `<pre>` ve stránce &ndash; náš text písně. Druhou proměnnou (`text`) pak naplníme samotným obsahem dané HTML značky; její datový typ bude řetězec. Používáme k tomu vlastnost `textContent`, která opět pochází ze světa DOM.

Následující řádek slouží ke skrytí většiny textu:
```js
song.textContent = text.substring(0, 50) + "...";
```

To je naše první opravdová *manipulace* s DOMem, tedy se stránkou! Přiřazením do vlastnosti `textContent` rozkazujeme, že je nutné HTML pozměnit nahrazením textu, který se zobrazuje uvnitř značky `<pre>` (tj. uvnitř proměnné `song`). Vypíšeme v ní prvních padesát znaků z textu (funkce `substring` vrátí podřetězec od/do zadané pozice) a k tomu ještě připojíme tři tečky &ndash; naznačení, že v těchto místech je cosi skryto. Můžeme si rovnou povšimnout použitého znaménka `+`, které v JavaScriptu funguje nejen pro aritmetiku (sčítání), ale také pro spojování řetězců. V dalších kapitolách ovšem uvidíme, že tato forma kombinace řetězců není jediná a často je vhodnější použít jiný zápis.

Následuje vytvoření tlačítka pro odkrytí zbylého textu. Seznámíme se tak s dalšími dvěma funkcemi rozhraní DOM &ndash; `createElement` pro vytvoření nového HTML prvku a `append` pro jeho vložení dovnitř stránky. V našem případě chceme tlačítko ukázat za vytečkovaným textem, tj. na konci HTML prvku `<pre>` (který máme uložený v proměnné `song`). Nově vytvořené tlačítko přiřadíme do proměnné `button`:
```js
let button = document.createElement("button");
button.textContent = "zobrazit celý text";
song.append(button);
```

Poslední přísada do funkčního řešení je sice drobná, ale zásadní. Musíme provázat kliknutí na tlačítko se zobrazením zbylého textu. Ve světě klientského JavaScriptu (a víceméně i kdykoliv jindy, kdy pracujeme s uživatelskými rozhraními) se k tomu používá koncept nazvaný *programování řízené událostmi* (anglicky *event-based programming*). V našem případě to znamená následující činnosti:

  1. Rozmyslet, při které události či interakci chceme nějaký JavaScript spustit.
  1. Připravit si tento kód a vytvořit pro něj JS *funkci*.
  1. Propojit výše uvedené pomocí DOM funkce `addEventListener`.

Těmto aktivitám odpovídají poslední řádky z řešení:
```js
function showCompleteText() {
	song.textContent = text;
}
button.addEventListener("click", showCompleteText);
```

Definice funkce je velmi jednoduchá, neboť nepotřebuje žádné parametry ani návratovou hodnotu. Zvláštní pozornost ale věnujme volání `addEventListener`, které prohlížeč instruuje, aby naši funkci (předanou jako druhý parametr) vykonal, jakmile nastane kliknutí myší (řetězec `"click"` v prvním parametru) &ndash; a to celé jen pokud událost nastane na HTML prvku, uloženém v proměnné `button`.

**Pozor!** Naši funkci `showCompleteText` sice definujeme, ale nikdy ji sami nevoláme. Nevíme totiž, kdy &ndash; to ví jen prohlížeč, který se od operačního systému dozví o kliknutí myší. Proto tuto funkci jen *předáváme* jako parametr pro `addEventListener`. Tento zápis může být pro začátečníka matoucí, neboť vzdáleně připomíná *volání* funkce, při kterém za její jméno ještě píšeme kulaté závorky.

V JavaScriptu je funkce docela běžný datový typ. Pro snazší pochopení se na ně můžeme dívat jako na obyčejné proměnné; dokonce je tak lze i definovat. V našem případě bychom klidně mohli psát
```js
let showCompleteText = function() {
  song.textContent = text;
}
```
Při tomto zápisu je pak předání hodnoty `showCompleteText` jako parametru do jiné funkce docela pochopitelné.

## Co jsme se naučili

Po vyřešení první úlohy by měl čtenář chápat a ovládat:

  - definici proměnných
  - definici funkce
  - nejdůležitější funkce a proměnné z rozhraní DOM: `document`, `querySelector`, `createElement`, `append` a `addEventListener`
  - základy konceptu programování řízeného událostmi

## Zelenáči: drobná vylepšení

Výše ukázané řešení je vystavěné přesně dle principu *make it work*. Nyní přišel čas na druhou fázi rčení, totiž *make it right*. Zkusíme kód vylepšit nikoliv ve smyslu jeho funkcionality, ale ve smyslu jeho praktického použití a znovupoužití.

Prvním nedostatkem je skutečnost, že jsme celý JavaScript napsali přímo do HTML dokumentu, mezi značky `<script>` a `</script>`. To přináší dvě nevýhody: jednak tento kód nelze znovupoužít v dalších stránkách, jednak teď náš dokument obsahuje zdrojový kód ve dvou jazycích (HTML a JS). Šikovnější by bylo, kdyby tyto dvě technologie mohly fungovat ve dvou různých souborech, a každý z nich by následně mohl měnit třeba jinak zdatný programátor. Oddělení JavaScriptu do samotného souboru je zcela běžná a přímočará operace: v HTML zůstane jen značka `<script>`, u které pomocí atributu `src` uvedeme, na které adrese se nachází soubor s JS kódem.

Další drobný nedostatek je použití čísla 50 při zkracování textu. Napříč všemi programovacími jazyky platí úmluva, že podobné veličiny ovlivňující fungování programu patří *na začátek zdrojového kódu*, abychom je nemuseli hledat, když vyvstane potřeba jejich změny. Pro nás je to ideální chvíle na seznámení s *konstantami* &ndash; to jsou hodnoty, které nelze měnit. Pracujeme s nimi jako s proměnnými, jen pro jejich definici použijeme klíčové slovo `const` (namísto `let`) a jistě nás nepřekvapí, že případný pokus o jejich změnu by vyústil v chybu.

Třetí vylepšení souvisí s tím, kolik různých změn provádíme ve stránce. Náš současný kód mění HTML prvek `<pre>`, jehož obsah nejprve nahradí (změna vlastnosti `textContent`) a o pár řádků později ještě obohatí o tlačítko. Zde můžeme naše řešení trochu zkrátit a ještě vylepšit jeho čitelnost, když obě změny (text i tlačítko) provedeme naráz. Stačí jen znát správnou funkci z rozhraní DOM, která obsah `<pre>` nahradí kombinací textu, výpustky (tak se správně říká trojtečce) a tlačítka. Její jméno je `replaceChildren` a jedná se o tzv. *variadickou funkci*. To znamená, že ji lze volat s libovolným počtem parametrů. Prohlížeč je vezme jeden po druhém a vystaví z nich nový obsah daného HTML prvku.

Po aplikování tří výše uvedených vylepšení pak řešení první úlohy vypadá následnovně. V HTML souboru zůstalo:
```html
<h1>Mám styl Čendy</h1>
<pre>
Mezi námi je mnoho chvil
A pokusů, abych se ti zavděčil
Jenomže od tebe se člověk moc nedoví
Stále básníš o ňákém svém záhadném Čendovi
</pre>

<script src="kapitola-2.js"></script>
```

A nově vytvořený soubor `kapitola-2.js` obsahuje:

```js
const LIMIT = 50;
let song = document.querySelector("pre");
let text = song.textContent;

let button = document.createElement("button");
button.textContent = "zobrazit celý text";
song.replaceChildren(text.substring(0, LIMIT), "…", button);

function showCompleteText() {
	song.textContent = text;
}
button.addEventListener("click", showCompleteText);
```

## Koumáci: začínáme s DOMem

## Profíci: druhy skriptů


