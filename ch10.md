# Kapitola 10: Intl, Storage, polyfilly a další API

## Úloha

V rámci webu věnovaného písním Karla Gotta připravujeme část s e-shopem. Na prodej budou originály textů jeho písní s podpisem textaře. Vypište tyto položky; každá obsahuje název písně, datum jejího vzniku a cenu v korunách.

### Řešení

Soupis písní bude opět pocházet z backendu, jehož rozhraní není pro tuto úlohu podstatné. Zajímá nás jen tvar dat jednotlivých položek, které budeme vykreslovat.

Název (řetězec) a cena (číslo) nejsou příliš zajímavé. Datum již představuje jistou výzvu, neboť jeho reprezentace napříč různými informačními systémy bývá různorodá. Zejména v případě formátu JSON (pracujeme s ním pravidelně od páté kapitoly) je nutné formát data s autory backendové komponenty dobře domluvit, protože JSON žádný datový typ pro datum neobsahuje. Možností je celá řada; nejčastěji se v praxi setkáváme se dvěma:

1. Datum zapsané ve formátu řetězce s pevnou strukturou. Standardní zápis bývá sestupně dle velikosti jednotky, tj. např. `1960-05-24`. Tímto způsobem může řetězec obsáhnout několik hodnot naráz (rok, měsíc, den) a pokud by to bylo nutné, můžeme přidat i časovou informaci v rámce dne (hodiny, minuty, &hellip;).
1. Datum zapsané jedním číslem, které vyjadřuje počet časových jednotek uplynulých od vhodně zvoleného počátku. Této formě se říká *timestamp* (časové razítko) a pro správné fungování je nutná dohoda na jednotkách (častá volba jsou sekundy či milisekundy) a počátku (v naprosté většině případů se používá datum 1. 1. 1970). S jediným číslem se pracuje snadno a elegantně, ovšem pro reprezentaci dne v roce to není nejlepší volba, mimo jiné proto, že pro jedno datum (jeden den) existuje spousta různých hodnot pro timestamp.

Pojďme naši implementaci postavit tak, že vstupní data budou v poli struktur s těmito klíči:

- `name` je název písně (string),
- `price` je cena (číslo),
- `date` je datum ve formátu `rok-měsíc-den` (řetězec), nebo timestamp ve vteřinách (číslo).


```html
<!-- kapitola-10.html -->
<h1>Písně k zakoupení</h1>
<ul></ul>

<script src="kapitola-10.js"></script>
```

```js
// kapitola-10.js
let DATA = [
	{name: "FIXME", date: 0, price: 123},
	{name: "FIXME", date: 0, price: 123},
	{name: "FIXME", date: 0, price: 123}
];

let dateFormat = new Intl.DateTimeFormat(undefined, {dateStyle:"long"});
let priceFormat = new Intl.NumberFormat(undefined, {style:"currency", currency:"CZK"});

function buildItem(item) {
	let li = document.createElement("li");

	let dateIsNumber = (typeof(item.date) == "number");
	let date = (dateIsNumber ? new Date(item.date*1000) : new Date(item.date));

	li.innerHTML = `
		<h3></h3>
		<span>Datum: ${dateFormat.format(date)}</span>
		<span>Cena: ${priceFormat.format(item.price)} Kč</span>
	`;
	li.children[0].textContent = item.name;
	return li;
}

let items  = DATA.map(buildItem);
document.querySelector("ul").replaceChildren(...items);
```

Charakteristickým rysem této úlohy je, že bychom k jejímu řešení mohli prostě použít to, co jsme se naučili v minulých kapitolách. Ale pro potřeby výpisu ceny a data by to bylo zbytečně pracné. Je praktičtější se nejprve podívat, jestli nám JavaScript nebo prohlížeč nenabízí nějakou vestavěnou funkcionalitu, díky které bychom mohli ušetřit čas a práci. V tomto případě se jedná o rozhraní `Intl`, jehož název je zkratkou z anglického *internationalization* -- funkce související se zobrazováním a zpracováním dat s ohledem na místní zvyklosti. Skutečně, cena i datum jsou příkladem veličin, které se v různých kulturách a jazycích zobrazují různě (a často docela komplikovaně). I kdybychom své stránky cílili výhradně na české uživatele, oceníme, když za nás naše regionální speciality vyřeší někdo jiný.

Globální proměnná `Intl` obsahuje několik tříd, určených pro zpracovávánní a formátování různých druhů dat, vždy s ohledem na pravidla zadaného jazyka. Ty nejdůležitější jsou:

- `Intl.Collator` pro (abecední) porovnávání řetězců
- `Intl.DateTimeFormat` pro formátování datumů a časů
- `Intl.DisplayNames` pro zobrazování názvů zemí, jazyků a měn
- `Intl.ListFormat` pro formátování posloupností hodnot
- `Intl.NumberFormat` pro zobrazování různých číselných hodnot
- `Intl.PluralRules` pro správnou volbu názvu v závislosti na počtu

V naší úloze používáme dva tyto objekty.

### NumberFormat

Pro zobrazení ceny si nejprve nachystáme *formátovací objekt*, tj. instanci `new NumberFormat()`. Jejím prvním parametrem je identifikátor jazyka, ve kterém chceme čísla zobrazovat. My předáváme hodnotu `undefined`, která znamená, že prohlížeč má použít svůj výchozí jazyk. To je praktické, neboť uživatelé v různých zemích uvidí naše data vždy dle svých regionálních preferencí.

V druhém parametru (konfiguračním objektu) uvádíme, jakou číselnou hodnotu zobrazujeme (a v jaké měně). Třída `NumberFormat` dovoluje formátování cen, fyzikálních veličin, procent a obecných čísel. Vzniklý formátovací objekt pak metodou `format` aplikujeme na konkrétní číselná data a zpět dostáváme řetězce určené k zobrazení.

FIXME priklad

### DateTimeFormat



## Zelenáči: Web Storage
## Koumáci: Polyfill
## Profíci: další API
