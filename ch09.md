# Kapitola 9: Web Components

## Úloha

Pohybujeme se stále v administračním systému, jehož hlavním účelem je správa a schvalování komentářů. Proveďte refaktoring existující třídy `Comment` pomocí konceptu Web Components.

### Řešení

```html
<!-- kapitola-9.html -->
<link rel="stylesheet" href="adm-comment.css">

<h2>Nové komentáře</h2>
<ul id="new"></ul>

<h2>Schválené komentáře</h2>
<ul id="approved"></ul>

<script type="module" src="kapitola-9.js"></script>
```

```js
// kapitola-9.js
import AdmComment from "./adm-comment.js";

export async function loadComments() {
	let response = await fetch("/comments");
	let data = await response.json();

	let newList = document.querySelector("#new");
	let approvedList = document.querySelector("#approved");
	newList.replaceChildren();
	approvedList.replaceChildren();

	comments.forEach(c => {
		let comment = new AdmComment(c);
		comment.addEventListener("change", loadComments);
		(c.approved ? approvedList : newList).append(comment);
	});
}

loadComments();
```

```js
// adm-comment.js
export default class AdmComment extends HTMLElement {
	constructor(data) {
		super();

		this.textContent = `${data.author}: ${data.text}`;

		if (!data.approved) { this.append(this.buildApproveButton()); }
		this.append(this.buildDeleteButton());

		this._id = data.id;
	}

	buildApproveButton() {
		let button = buildButton("Schválit");
		button.addEventListener("click", async e => {
			await this.approve();
			this.dispatchEvent(new CustomEvent("change"));
		});
		return button;
	}

	buildDeleteButton() {
		let button = buildButton("Smazat");
		button.addEventListener("click", async e => {
			await this.delete();
			this.dispatchEvent(new CustomEvent("change"));
		});
		return button;
	}

	delete() {
		return fetch(`/comments/${this._id}`, {method: "DELETE"});
	}

	approve(id) {
		return fetch(`/comments/${this._id}/approve`, {method: "POST"});
	}
}

customElements.define("adm-comment", AdmComment);

function buildButton(label) {
	let button = document.createElement("button");
	button.textContent = label;
	return button;
}
```

```css
/* adm-comment.css */
adm-comment {
	display: list-item;
}
```
